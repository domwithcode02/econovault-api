# Render Sandbox Environment Configuration
# This configuration sets up a sandbox environment for testing and development

services:
  - type: web
    name: econovault-api-sandbox
    env: docker
    repo: https://github.com/domwithcode02/econovault-api  # Replace with your repo
    branch: develop  # Use develop branch for sandbox
    dockerContext: ./backend
    dockerfilePath: ./backend/Dockerfile
    # Sandbox configuration - single instance with limited resources
    numInstances: 1
    autoDeploy: true
    healthCheck:
      path: /health
      interval: 30
      timeout: 10
      restartPolicyType: on_failure
      maxRetries: 3
    # Sandbox environment variables
    envVars:
      # Database Configuration (Sandbox database)
      - key: DATABASE_URL
        fromDatabase:
          name: econovault-sandbox-db
          property: connectionString
      # Security Keys (generated by Render)
      - key: SECRET_KEY
        generateValue: true
      - key: MASTER_ENCRYPTION_KEY
        generateValue: true
      # Sandbox API Keys (mock data for testing)
      - key: BLS_API_KEY
        value: "sandbox-bls-key"
      - key: BEA_API_KEY
        value: "sandbox-bea-key"
      - key: FRED_API_KEY
        value: "sandbox-fred-key"
      # Sandbox Configuration
      - key: ENVIRONMENT
        value: "sandbox"
      - key: DEBUG
        value: true
      - key: LOG_LEVEL
        value: "DEBUG"
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: PYTHONDONTWRITEBYTECODE
        value: "1"
      - key: WAIT_FOR_DB
        value: "true"
      - key: RUN_MIGRATIONS
        value: "true"
      # Sandbox-specific settings
      - key: ENABLE_SANDBOX_MODE
        value: "true"
      - key: SANDBOX_DATA_LIMIT
        value: "1000"  # Limit data points in sandbox
      - key: RATE_LIMIT_PER_MINUTE
        value: "120"  # Relaxed rate limiting for testing
      - key: RATE_LIMIT_PER_HOUR
        value: "7200"
      - key: MOCK_EXTERNAL_APIS
        value: "true"  # Use mock data instead of real API calls
      - key: ENABLE_TEST_ENDPOINTS
        value: "true"  # Enable test-only endpoints
      # Monitoring (reduced retention for sandbox)
      - key: ENABLE_METRICS
        value: "true"
      - key: METRICS_RETENTION_DAYS
        value: "7"
      # Relaxed security for testing
      - key: SECURE_HEADERS
        value: "false"
      - key: CORS_ORIGINS
        value: "*"
      - key: SHOW_ERROR_DETAILS
        value: "true"
    # Small disk for sandbox testing
    disk:
      name: econovault-sandbox-data
      mountPath: /app/data
      sizeGB: 5
    # Pre-deploy commands
    preDeployCommand: "python -c 'import asyncio; from database import init_db; asyncio.run(init_db())'"

# Sandbox database (free tier)
databases:
  - name: econovault-sandbox-db
    databaseName: econovault_sandbox
    user: econovault_sandbox_user
    plan: free  # Free tier for sandbox
    postgresVersion: "15"
    highAvailability: false  # No HA needed for sandbox
    backupRetention: 7  # 7-day backup retention

# Environment groups for sandbox
envGroups:
  - name: econovault-sandbox
    envVars:
      - key: ENVIRONMENT
        value: sandbox
      - key: LOG_LEVEL
        value: DEBUG
      - key: ENABLE_SANDBOX_MODE
        value: "true"
      - key: MOCK_EXTERNAL_APIS
        value: "true"

# Note: This sandbox environment provides:
# - Mock data instead of real API calls
# - Relaxed rate limiting for testing
# - Debug logging and detailed error messages
# - Test-only endpoints
# - Smaller resource allocation
# - Shorter data retention